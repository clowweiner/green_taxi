<!DOCTYPE html>

<svg width="1000" height="800"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>

<script>

  var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height");
  
  var rx = d3.randomUniform(-74.2, -74.1),
      ry = d3.randomUniform(40.6, 40.7),
      points = d3.range(30).map(function() { return [rx(), ry()]; });
  
  var hexbin = d3.hexbin()
      .radius(20)
      .extent([[0, 0], [width, height]]);
  

  var projection = d3.geoMercator()
      .center([-73.94, 40.70])
      .scale(70000)
      .translate([(width) / 2, (height)/2]);
  
  var path = d3.geoPath()
      .projection(projection);
  
  function clickHex(d) {
      
      this.parentNode.appendChild(this);
      
      d3.select(this)
	  .transition()
	  .duration(5000)
	  .attr("transform", "translate(800,400)rotate(20)");
  }
  
  // d3.json("boros.GeoJSON", function(error, nyb) {
  //     console.log(nyb);

  //     svg.selectAll("path")
  // 	  .data(nyb.features)
  // 	  .enter().append("path")
  // 	  .attr("class", "boro")
  // 	  .style("fill", "steelblue")
  // 	  .attr("d", path);

  //     svg.append("g")
  // 	  .attr("class", "hexagon")
  // 	  .selectAll("path")
  // 	  .data(points)
  // 	  .enter().append("path")
  // 	  .attr("d", function(d) { console.log(projection(d)); return "M" + projection(d)[0] + "," + projection(d)[1] + hexbin.hexagon(5); })
  // 	  .attr("fill", "blue");

  // });

  var toggleColor = (function(){
      var currentColor = "white";
      
      return function(){
          currentColor = currentColor == "white" ? "black" : "white";
          d3.select(this).style("stroke", currentColor);
      }
  })();

  var colors = ["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]


  d3.json("hexGrid.GeoJSON", function(error, hex) {
      var hexes = svg.selectAll("path")
   	  .data(hex.features)
   	  .enter().append("path")
   	  .attr("class", "hex")
          .attr("d", path)
	  .attr("fill","green")
	  .on("click",clickHex)
	  .transition().delay(2000)
	  .on("start", function repeat() {
              d3.active(this)
		  .attr("fill", colors[0])
		  .transition().duration(2000)
	      	  .attr("fill", colors[1])
		  .transition().duration(2000)
	      	  .attr("fill", colors[2])
		  .transition().duration(2000)
	      	  .attr("fill", colors[3])
		  .transition().duration(2000)
	      	  .attr("fill", colors[4])
		  .transition().duration(2000)
	      	  .attr("fill", colors[5])
		  .transition().duration(2000)
	      	  .attr("fill", colors[6])
		  .transition().duration(2000)
	      	  .attr("fill", colors[7])
		  .transition().duration(2000)
		  .on("start", repeat);
	  });



      
      // repeat();
      
      // function repeat() {
      // 	  hexes.style("fill","purple")
      // 	      .transition().duration(2000)
      // 	      .style("fill","green")
      // 	      .transition().duration(2000)
      // 	      .style("fill","pink")
      // 	      .transition().duration(2000)
      // 	      .style("fill","orange")
      // 	      .on("end",repeat);
      // }
  });




//   function circleTransition() { 

//     var timeCircle = svg.append("circle")
//         .attr("fill", "steelblue")
//         .attr("r", 20);
//     repeat();
    
//     function repeat() {
//       timeCircle
//         .attr('cx', 40)      // position the circle at 40 on the x axis
//         .attr('cy', 250)     // position the circle at 250 on the y axis
//         .transition()        // apply a transition
//         .duration(2000)      // apply it over 2000 milliseconds
//         .attr('cx', 920)     // move the circle to 920 on the x axis
//         .transition()        // apply a transition
//         .duration(2000)      // apply it over 2000 milliseconds
//         .attr('cx', 40)      // return the circle to 40 on the x axis
//         .on("end", repeat);  // when the transition finishes start again
//     };

// };

// circleTransition();
</script>
